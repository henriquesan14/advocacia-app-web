<form nz-form [formGroup]="formPartes" (ngSubmit)="onSubmit()" nzLayout="vertical">
  <nz-row [nzGutter]="16">
    <nz-col [nzSpan]="12">
      <nz-form-item>
        <nz-form-label [nzRequired]="true" nzFor="nome">Nome Completo</nz-form-label>
        <nz-form-control [nzErrorTip]="nomeErrorTpl">
          <input nz-input formControlName="nome" id="nome" maxlength="100" />
          <ng-template #nomeErrorTpl let-control>
            @if (control.hasError('required')) {
              O campo é obrigatório
            }
          </ng-template>
        </nz-form-control>
      </nz-form-item>
    </nz-col>

    <nz-col [nzSpan]="12">
      <nz-form-item>
        <nz-form-label nzFor="email">Email</nz-form-label>
        <nz-form-control [nzErrorTip]="emailErrorTpl">
          <input nz-input formControlName="email" id="email" maxlength="100" />
          <ng-template #emailErrorTpl let-control>
            @if (control.hasError('email')) {
              O campo deve ser um email válido
            }
          </ng-template>
        </nz-form-control>
      </nz-form-item>
    </nz-col>

    <nz-col [nzSpan]="12">
      <nz-form-item>
        <nz-form-label nzFor="tipoPessoa">Tipo Pessoa</nz-form-label>
        <nz-form-control>
          <nz-radio-group formControlName="tipoPessoa">
            <label nz-radio [nzValue]="'PESSOA_FISICA'">Pessoa Física</label>
            <label nz-radio [nzValue]="'PESSOA_JURIDICA'">Pessoa Jurídica</label>
          </nz-radio-group>
        </nz-form-control>
      </nz-form-item>
    </nz-col>

    <nz-col [nzSpan]="12">
      <nz-form-item>
        <nz-form-label nzFor="cpfCnpj">CPF/CNPJ</nz-form-label>
        <nz-form-control [nzErrorTip]="cpfCnpjErrorTpl">
          <input nz-input formControlName="cpfCnpj" id="cpfCnpj" [mask]="getMaskCpfCnpj()" />
          <ng-template #cpfCnpjErrorTpl let-control>
            @if (control.hasError('required')) {
              O campo é obrigatório
            }
          </ng-template>
        </nz-form-control>
      </nz-form-item>
    </nz-col>

    <nz-col [nzSpan]="12">
      <nz-form-item>
        <nz-form-label nzFor="dataNascimento">Data de Nascimento</nz-form-label>
        <nz-form-control [nzErrorTip]="dataNascimentoErrorTpl">
          <nz-date-picker formControlName="dataNascimento" nzFormat="dd/MM/yyyy"></nz-date-picker>
          <ng-template #dataNascimentoErrorTpl let-control>
            @if (control.hasError('futureDate')) {
              Não pode ser uma data futura
            }
          </ng-template>
        </nz-form-control>
      </nz-form-item>
    </nz-col>

    <nz-col [nzSpan]="12">
      <nz-form-item>
        <nz-form-label nzFor="telefone">Telefone</nz-form-label>
        <nz-form-control [nzErrorTip]="telefoneErrorTpl">
          <input nz-input formControlName="telefone" id="telefone" mask="(00) 0 0000-0000" />
          <ng-template #telefoneErrorTpl let-control>
            @if (control.hasError('pattern')) {
              Telefone inválido
            }
          </ng-template>
        </nz-form-control>
      </nz-form-item>
    </nz-col>

    <nz-col [nzSpan]="24">
      <nz-form-item>
        <nz-form-control>
          <label nz-checkbox formControlName="isCliente">É nosso cliente?</label>
        </nz-form-control>
      </nz-form-item>
    </nz-col>
  </nz-row>

  <!-- Endereço -->
  <fieldset formGroupName="endereco">
    <h3 class="mt-3">Endereço</h3>
    <nz-row [nzGutter]="16">
      <nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label nzFor="cep">CEP</nz-form-label>
          <nz-form-control [nzErrorTip]="cepErrorTpl">
            <input nz-input formControlName="cep" id="cep" mask="00000-000" (blur)="getCep()" />
            <ng-template #cepErrorTpl let-control>
              @if (control.hasError('required')) {
                O campo é obrigatório
              }
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label nzFor="logradouro">Logradouro</nz-form-label>
          <nz-form-control [nzErrorTip]="logradouroErrorTpl">
            <input nz-input formControlName="logradouro" id="logradouro" maxlength="100" />
            <ng-template #logradouroErrorTpl let-control>
              @if (control.hasError('required')) {
                O campo é obrigatório
              }
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label nzFor="numero">Número</nz-form-label>
          <nz-form-control [nzErrorTip]="numeroErrorTpl">
            <input nz-input formControlName="numero" id="numero" maxlength="10" />
            <ng-template #numeroErrorTpl let-control>
              @if (control.hasError('required')) {
                O campo é obrigatório
              }
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label nzFor="complemento">Complemento</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="complemento" id="complemento" maxlength="100" />
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label nzFor="bairro">Bairro</nz-form-label>
          <nz-form-control [nzErrorTip]="bairroErrorTpl">
            <input nz-input formControlName="bairro" id="bairro" maxlength="100" />
            <ng-template #bairroErrorTpl let-control>
              @if (control.hasError('required')) {
                O campo é obrigatório
              }
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label nzFor="estado">Estado</nz-form-label>
          <nz-form-control [nzErrorTip]="estadoErrorTpl">
            <nz-select formControlName="estado" id="estado" (ngModelChange)="getCidades()" placeholder="Selecione">
              <nz-option nzDisabled [nzLabel]="'Selecione um estado'" [nzValue]="''"></nz-option>
              @for(estado of estados; track $index){
                <nz-option [nzValue]="estado.id" [nzLabel]="estado.nome"></nz-option>
              }
            </nz-select>
            <ng-template #estadoErrorTpl let-control>
              @if (control.hasError('required')) {
                O campo é obrigatório
              }
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </nz-col>

      <nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label nzFor="cidade">Cidade</nz-form-label>
          <nz-form-control [nzErrorTip]="cidadeErrorTpl">
            <nz-select formControlName="cidade" id="cidade" placeholder="Selecione">
              <nz-option nzDisabled [nzLabel]="'Selecione uma cidade'" [nzValue]="''"></nz-option>
              @for(cidade of cidades; track $index){
                <nz-option [nzValue]="cidade.id" [nzLabel]="cidade.nome"></nz-option>
              }
            </nz-select>
            <ng-template #cidadeErrorTpl let-control>
              @if (control.hasError('required')) {
                O campo é obrigatório
              }
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </nz-col>
    </nz-row>
  </fieldset>

  <!-- Botões -->
  <nz-form-item class="mt-4">
    <nz-form-control>
      @if(data){
        <button nz-button nzType="primary" hasRole="EDITAR_PARTE">Atualizar</button>
      }@else{
        <button nz-button nzType="primary" hasRole="CADASTRAR_PARTE">Cadastrar</button>
      }
    </nz-form-control>
  </nz-form-item>
</form>

<ngx-spinner type="ball-clip-rotate-multiple"></ngx-spinner>
